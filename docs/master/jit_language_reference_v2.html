


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TorchScript Language Reference &mdash; PyTorch master documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://pytorch.org/docs/stable/jit_language_reference_v2.html"/>
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/jit.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="torch.jit.script" href="generated/torch.jit.script.html" />
    <link rel="prev" title="TorchScript Language Reference" href="jit_language_reference.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="active">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-orange-arrow">
                Docs
              </a>
              <div class="resources-dropdown-menu">
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                  <span class="dropdown-title">PyTorch</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/audio/stable/index.html">
                  <span class="dropdown-title">torchaudio</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/text/stable/index.html">
                  <span class="dropdown-title">torchtext</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/vision/stable/index.html">
                  <span class="dropdown-title">torchvision</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/elastic/">
                  <span class="dropdown-title">TorchElastic</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/serve/">
                  <span class="dropdown-title">TorchServe</span>
                  <p></p>
                </a>
                <a class="doc-dropdown-option nav-dropdown-item" href="https://pytorch.org/xla">
                  <span class="dropdown-title">PyTorch on XLA Devices</span>
                  <p></p>
                </a>
            </div>
          </li>

          <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
              <a class="resource-option with-down-arrow">
                Resources
              </a>
              <div class="resources-dropdown-menu">
                <a class="nav-dropdown-item" href="https://pytorch.org/features">
                  <span class="dropdown-title">About</span>
                  <p>Learn about PyTorch’s features and capabilities</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                  <span class="dropdown-title">Community</span>
                  <p>Join the PyTorch developer community to contribute, learn, and get your questions answered.</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                  <span class="dropdown-title">Developer Resources</span>
                  <p>Find resources and get questions answered</p>
                </a>
                <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                  <span class="dropdown-title">Forums</span>
                  <p>A place to discuss PyTorch code, issues, install, research</p>
                </a>
                <a class="nav-dropdown-item" href="https://pytorch.org/hub">
                  <span class="dropdown-title">Models (Beta)</span>
                  <p>Discover, publish, and reuse pre-trained models</p>
                </a>
              </div>
            </div>
          </li>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pytorch.org/docs/versions.html'>master (1.9.0a0+git732df43 ) &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          

<div>
  <a style="color:#F05732" href="https://pytorch.org/docs/stable/jit_language_reference_v2.html">
    You are viewing unstable developer preview docs.
    Click here to view docs for latest stable release.
  </a>
</div>


            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notes/amp_examples.html">Automatic Mixed Precision examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/autograd.html">Autograd mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/broadcasting.html">Broadcasting semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cpu_threading_torchscript_inference.html">CPU threading and TorchScript inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/cuda.html">CUDA semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/ddp.html">Distributed Data Parallel</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/extending.html">Extending PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/large_scale_deployments.html">Features for large-scale deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/multiprocessing.html">Multiprocessing best practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/randomness.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/serialization.html">Serialization semantics</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes/windows.html">Windows FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Language Bindings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp_index.html">C++</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/javadoc/">Javadoc</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">torch.nn</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.functional.html">torch.nn.functional</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensors.html">torch.Tensor</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_attributes.html">Tensor Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensor_view.html">Tensor Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="autograd.html">torch.autograd</a></li>
<li class="toctree-l1"><a class="reference internal" href="cuda.html">torch.cuda</a></li>
<li class="toctree-l1"><a class="reference internal" href="amp.html">torch.cuda.amp</a></li>
<li class="toctree-l1"><a class="reference internal" href="backends.html">torch.backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.html">torch.distributed</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributed.optim.html">torch.distributed.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="distributions.html">torch.distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">torch.fft</a></li>
<li class="toctree-l1"><a class="reference internal" href="futures.html">torch.futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="fx.html">torch.fx</a></li>
<li class="toctree-l1"><a class="reference internal" href="hub.html">torch.hub</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="jit.html">torch.jit</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">torch.linalg</a></li>
<li class="toctree-l1"><a class="reference internal" href="special.html">torch.special</a></li>
<li class="toctree-l1"><a class="reference internal" href="torch.overrides.html">torch.overrides</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiler.html">torch.profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.init.html">torch.nn.init</a></li>
<li class="toctree-l1"><a class="reference internal" href="onnx.html">torch.onnx</a></li>
<li class="toctree-l1"><a class="reference internal" href="optim.html">torch.optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex_numbers.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="ddp_comm_hooks.html">DDP Communication Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline.html">Pipeline Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">Distributed RPC Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="random.html">torch.random</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">torch.sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">torch.Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark_utils.html">torch.utils.benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottleneck.html">torch.utils.bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkpoint.html">torch.utils.checkpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_extension.html">torch.utils.cpp_extension</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">torch.utils.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlpack.html">torch.utils.dlpack</a></li>
<li class="toctree-l1"><a class="reference internal" href="mobile_optimizer.html">torch.utils.mobile_optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">torch.utils.model_zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="tensorboard.html">torch.utils.tensorboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="type_info.html">Type Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="named_tensor.html">Named Tensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="name_inference.html">Named Tensors operator coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="__config__.html">torch.__config__</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/audio/stable">torchaudio</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/text/stable">torchtext</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/vision/stable">torchvision</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/elastic/">TorchElastic</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pytorch.org/serve">TorchServe</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pytorch.org/xla/">PyTorch on XLA Devices</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="community/contribution_guide.html">PyTorch Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/governance.html">PyTorch Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="community/persons_of_interest.html">PyTorch Governance | Persons of Interest</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="jit.html">TorchScript</a> &gt;</li>
        
      <li>TorchScript Language Reference</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
            
            <a href="_sources/jit_language_reference_v2.rst.txt" rel="nofollow"><img src="_static/images/view-page-source-icon.svg"></a>
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#torchscript-language-reference" id="id5">TorchScript Language Reference</a></p>
<ul>
<li><p><a class="reference internal" href="#type-system" id="id6">Type System</a></p></li>
<li><p><a class="reference internal" href="#type-annotation" id="id7">Type Annotation</a></p></li>
<li><p><a class="reference internal" href="#expressions" id="id8">Expressions</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="torchscript-language-reference">
<span id="language-reference-v2"></span><h1><a class="toc-backref" href="#id5">TorchScript Language Reference</a><a class="headerlink" href="#torchscript-language-reference" title="Permalink to this headline">¶</a></h1>
<div class="section" id="type-system">
<span id="id1"></span><h2><a class="toc-backref" href="#id6">Type System</a><a class="headerlink" href="#type-system" title="Permalink to this headline">¶</a></h2>
<p>This section summarizes TorchScript type system.</p>
<div class="section" id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>This document uses the following terminologies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot; &quot;</span> <span class="n">represents</span> <span class="n">real</span> <span class="n">keywords</span> <span class="ow">and</span> <span class="n">delimiters</span> <span class="n">that</span> <span class="n">are</span> <span class="n">part</span> <span class="n">of</span> <span class="n">the</span> <span class="n">syntax</span>
<span class="n">A</span> <span class="o">|</span> <span class="n">B</span> <span class="n">indicates</span> <span class="n">either</span> <span class="n">A</span> <span class="ow">or</span> <span class="n">B</span>
<span class="p">(</span> <span class="p">)</span> <span class="n">indicates</span> <span class="n">grouping</span>
<span class="p">[</span> <span class="p">]</span> <span class="n">indicates</span> <span class="n">optional</span>
<span class="n">A</span><span class="o">+</span> <span class="n">indicates</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">expression</span> <span class="n">where</span> <span class="n">term</span> <span class="n">A</span> <span class="ow">is</span> <span class="n">repeated</span> <span class="n">at</span> <span class="n">least</span> <span class="n">once</span>
<span class="n">A</span><span class="o">*</span> <span class="n">indicates</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">expression</span> <span class="n">where</span> <span class="n">term</span> <span class="n">A</span> <span class="ow">is</span> <span class="n">repeated</span> <span class="n">zero</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">times</span>
</pre></div>
</div>
</div>
<div class="section" id="torchscript-type-system-definition">
<h3>TorchScript Type System Definition<a class="headerlink" href="#torchscript-type-system-definition" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSAllType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>

<span class="n">TSMetaType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Any&quot;</span>
<span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;double&quot;</span> <span class="o">|</span> <span class="s2">&quot;complex&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span>

<span class="n">TSStructualType</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span>
                    <span class="n">TSOptional</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span>
<span class="n">TSTuple</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Tuple&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSNamedTuple</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;namedtuple&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;)&quot;</span>
<span class="n">TSList</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;List&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSOptional</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Optional&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSFuture</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Future&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSRRef</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;RRef&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSDict</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Dict&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">KeyType</span> <span class="s2">&quot;,&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">KeyType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">&quot;Any&quot;</span>

<span class="n">TSNominalType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
<span class="n">TSBuiltinClass</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">&quot;torch.device&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.stream&quot;</span><span class="o">|</span>
                <span class="s2">&quot;torch.dtype&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.nn.ModuleList&quot;</span> <span class="o">|</span>
                <span class="s2">&quot;torch.nn.ModuleDict&quot;</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;torch.tensor&quot;</span> <span class="ow">and</span> <span class="n">subclasses</span>
</pre></div>
</div>
</div>
<div class="section" id="torchscript-types">
<h3>TorchScript Types<a class="headerlink" href="#torchscript-types" title="Permalink to this headline">¶</a></h3>
<p>The TorchScript type system consists of <code class="docutils literal notranslate"><span class="pre">TSType</span></code> and <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> as defined below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSAllType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSType</span> <span class="o">|</span> <span class="n">TSModuleType</span>
<span class="n">TSType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSMetaType</span> <span class="o">|</span> <span class="n">TSPrimitiveType</span> <span class="o">|</span> <span class="n">TSStructuralType</span> <span class="o">|</span> <span class="n">TSNominalType</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TSType</span></code> represents the majority of TorchScript types that are composable and can be used in TorchScript type annotation.
<code class="docutils literal notranslate"><span class="pre">TSType</span></code> can be further classified into:</p>
<ul class="simple">
<li><p>meta types, e.g., <code class="docutils literal notranslate"><span class="pre">Any</span></code></p></li>
<li><p>primitive types, e.g., <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code></p></li>
<li><p>structural types, e.g., <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> or <code class="docutils literal notranslate"><span class="pre">List[MyClass]</span></code></p></li>
<li><p>nominal types (Python classes), e.g., <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> (user-defined), <code class="docutils literal notranslate"><span class="pre">torch.tensor</span></code> (builtin)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> represents <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> and its subclasses. It is treated differently from <code class="docutils literal notranslate"><span class="pre">TSType</span></code> because its type schema is inferred partly from the object instance and partly from the class definition.
As such, instances of a <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> may not follow the same static type schema. <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> cannot be used as a TorchScript type annotation or be composed with <code class="docutils literal notranslate"><span class="pre">TSType</span></code> for type safety considerations.</p>
</div>
<div class="section" id="meta-types">
<h3>Meta Types<a class="headerlink" href="#meta-types" title="Permalink to this headline">¶</a></h3>
<p>Meta types are so abstract that they are more like type constraints than concrete types.
Currently TorchScript defines one meta-type, <code class="docutils literal notranslate"><span class="pre">Any</span></code>, that represents any TorchScript type.</p>
<div class="section" id="any-type">
<h4><code class="docutils literal notranslate"><span class="pre">Any</span></code> Type<a class="headerlink" href="#any-type" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Any</span></code> type literally represents any type. <code class="docutils literal notranslate"><span class="pre">Any</span></code> specifies no type constraints, thus there is no type checking on <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
As such it can be bound to any Python or TorchScript data types (e.g., int, TorchScript <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, or an arbitrary Python class that is not scripted).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSMetaType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Any&quot;</span>
</pre></div>
</div>
<p>where</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Any</span></code> is the Python class name from the typing module, therefore usage of the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type requires from <code class="docutils literal notranslate"><span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Any</span></code></p></li>
<li><p>Since <code class="docutils literal notranslate"><span class="pre">Any</span></code> can represent any type, the set of operators allowed to operate on values of this type on Any is limited.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="operators-supported-for-any-type">
<h4>Operators supported for <code class="docutils literal notranslate"><span class="pre">Any</span></code> type<a class="headerlink" href="#operators-supported-for-any-type" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>assignment to data of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type</p></li>
<li><p>binding to parameter or return of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isinstance(x,</span> <span class="pre">Type)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type</p></li>
<li><p>data of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type is printable</p></li>
<li><p>Data of <code class="docutils literal notranslate"><span class="pre">List[Any]</span></code> type may be sortable if the data is a list of values of the same type <code class="docutils literal notranslate"><span class="pre">T</span></code> and that <code class="docutils literal notranslate"><span class="pre">T</span></code> supports comparison operators</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Any</span></code> is the least constrained type in the TorchScript type system. In that sense, it is quite similar to
Object class in Python. However, <code class="docutils literal notranslate"><span class="pre">Any</span></code> only supports a subset of the operators and methods that are supported by Object.</p>
</div>
<div class="section" id="design-notes">
<h4>Design notes<a class="headerlink" href="#design-notes" title="Permalink to this headline">¶</a></h4>
<p>When we script a PyTorch module, we may encounter data that are not involved in the execution of the script, nevertheless has to be described
by a type schema. It is not only cumbersome to describe static types for unused data (in the context of the script) but also may lead to unnecessary
scripting failures. <code class="docutils literal notranslate"><span class="pre">Any</span></code> is introduced to describe the type of the data where precise static types are not necessary for compilation.</p>
<p><strong>Example</strong>:</p>
<p>This example illustrates how <code class="docutils literal notranslate"><span class="pre">Any</span></code> can be used to allow the second element of the tuple parameter to be of <code class="docutils literal notranslate"><span class="pre">any</span></code> type. This is possible,
because <code class="docutils literal notranslate"><span class="pre">x[1]</span></code> is not involved in any computation that requires knowing its precise type.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">incFirstElement</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">incFirstElement</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,(</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">))))</span>
</pre></div>
</div>
<p>The example will generate the following output, where the second element of the tuple is of <code class="docutils literal notranslate"><span class="pre">Any</span></code> type
thus can bind to multiple types, e.g., (1, 2.0) binds a float type to <code class="docutils literal notranslate"><span class="pre">Any</span></code> as in <code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">Any]</span></code>,
whereas <code class="docutils literal notranslate"><span class="pre">(1,</span> <span class="pre">(100,</span> <span class="pre">200))</span></code> binds a tuple to <code class="docutils literal notranslate"><span class="pre">Any</span></code> in the second invocation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 2.0)
(2, (100, 200))
</pre></div>
</div>
<p><strong>Example</strong>:</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> to dynamically check the type of the data annotated as <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="n">Any</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">))</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">2</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">))</span>
</pre></div>
</div>
<p>The above example produces the following output</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> 1
 1
[ CPUFloatType{2} ]
True
</pre></div>
</div>
</div>
</div>
<div class="section" id="primitive-types">
<h3>Primitive Types<a class="headerlink" href="#primitive-types" title="Permalink to this headline">¶</a></h3>
<p>Primitive TorchScript types represent types that represent a single type of value and go with a single pre-defined
type name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSPrimitiveType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;double&quot;</span> <span class="o">|</span> <span class="s2">&quot;complex&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;None&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="structural-types">
<h3>Structural Types<a class="headerlink" href="#structural-types" title="Permalink to this headline">¶</a></h3>
<p>Structural types are types that are structurally defined without a user-defined name (unlike nominal types),
such as <code class="docutils literal notranslate"><span class="pre">Future[int]</span></code>. Structural types are composable with any <code class="docutils literal notranslate"><span class="pre">TSType</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSStructuralType</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">TSTuple</span> <span class="o">|</span> <span class="n">TSNamedTuple</span> <span class="o">|</span> <span class="n">TSList</span> <span class="o">|</span> <span class="n">TSDict</span> <span class="o">|</span>
                    <span class="n">TSOptional</span> <span class="o">|</span> <span class="n">TSFuture</span> <span class="o">|</span> <span class="n">TSRRef</span>

<span class="n">TSTuple</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Tuple&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSNamedTuple</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;namedtuple&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="p">(</span><span class="n">TSType</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">*</span> <span class="n">TSType</span> <span class="s2">&quot;)&quot;</span>
<span class="n">TSList</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;List&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSOptional</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Optional&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSFuture</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Future&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSRRef</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;RRef&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">TSDict</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;Dict&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">KeyType</span> <span class="s2">&quot;,&quot;</span> <span class="n">TSType</span> <span class="s2">&quot;]&quot;</span>
<span class="n">KeyType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;str&quot;</span> <span class="o">|</span> <span class="s2">&quot;int&quot;</span> <span class="o">|</span> <span class="s2">&quot;float&quot;</span> <span class="o">|</span> <span class="s2">&quot;bool&quot;</span> <span class="o">|</span> <span class="n">TensorType</span> <span class="o">|</span> <span class="s2">&quot;Any&quot;</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code>, <code class="docutils literal notranslate"><span class="pre">Optional</span></code>, <code class="docutils literal notranslate"><span class="pre">Union</span></code>, <code class="docutils literal notranslate"><span class="pre">Future</span></code>, <code class="docutils literal notranslate"><span class="pre">Dict</span></code> represent Python type class names defined in module <code class="docutils literal notranslate"><span class="pre">typing</span></code>. Therefore before using these type names, one must import them from <code class="docutils literal notranslate"><span class="pre">typing</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple)</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">namedtuple</span></code> represents Python class  <code class="docutils literal notranslate"><span class="pre">collections.namedtuple</span></code> or <code class="docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code> .</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Future</span></code> and <code class="docutils literal notranslate"><span class="pre">RRef</span></code> represent Python classes  <code class="docutils literal notranslate"><span class="pre">torch.futures</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.distributed.rpc</span></code>.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<ul class="simple">
<li><p>Apart from being composable with TorchScript types, these TorchScript structural types often support a common subset of the operators and methods of their Python counterparts.</p></li>
</ul>
<p><strong>Example</strong>:</p>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">typing.NamedTuple</span></code> syntax:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="k">class</span> <span class="nc">MyTuple</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">first</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">second</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">MyTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">MyTuple</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scripted_inc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">scripted_inc</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TorchScript: (2, 3)
</pre></div>
</div>
<p>This example uses <code class="docutils literal notranslate"><span class="pre">collections.namedtuple</span></code> syntax:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">_AnnotatedNamedTuple</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;_NamedTupleAnnotated&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<span class="n">_UnannotatedNamedTuple</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;_NamedTupleAnnotated&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">_AnnotatedNamedTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">first</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">second</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inc</span><span class="p">(</span><span class="n">_UnannotatedNamedTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(2, 3)
</pre></div>
</div>
<p><strong>Example</strong>:</p>
<p>This example illustrates a common mistake of annotating structural types, i.e., not importing the composite type
classes from the <code class="docutils literal notranslate"><span class="pre">typing</span></code> module.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># ERROR: Tuple not recognized because not imported from typing</span>
<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Running the above codes yields the following scripting error. The remedy is to add from <code class="docutils literal notranslate"><span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Tuple</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">File</span> <span class="s2">&quot;test-tuple.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="ne">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;Tuple&#39;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defined</span>
</pre></div>
</div>
</div>
<div class="section" id="nominal-types">
<h3>Nominal Types<a class="headerlink" href="#nominal-types" title="Permalink to this headline">¶</a></h3>
<p>Nominal TorchScript types are Python classes. They are called nominal because these types are declared with a custom
name and are compared using class names. Nominal classes are further classified into the following categories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSNominalType</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSBuiltinClasses</span> <span class="o">|</span> <span class="n">TSCustomClass</span> <span class="o">|</span> <span class="n">TSEnum</span>
</pre></div>
</div>
<p>Among them, <code class="docutils literal notranslate"><span class="pre">TSCustomClass</span></code> and <code class="docutils literal notranslate"><span class="pre">TSEnum</span></code> must be compilable to TorchScript IR (as enforced by the type-checker).</p>
</div>
<div class="section" id="builtin-class">
<h3>Builtin Class<a class="headerlink" href="#builtin-class" title="Permalink to this headline">¶</a></h3>
<p>Builtin nominal types are Python classes whose semantics are built into the TorchScript system, such as tensor types.
TorchScript defines the semantics of these builtin nominal types, and often supports only a subset of the methods or
attributes of its Python class definition.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSBuiltinClass</span> <span class="p">:</span><span class="o">:=</span> <span class="n">TSTensor</span> <span class="o">|</span> <span class="s2">&quot;torch.device&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.Stream&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.dtype&quot;</span> <span class="o">|</span>
                <span class="s2">&quot;torch.nn.ModuleList&quot;</span> <span class="o">|</span> <span class="s2">&quot;torch.nn.ModuleDict&quot;</span> <span class="o">|</span> <span class="o">...</span>
<span class="n">TSTensor</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;torch.Tensor&quot;</span> <span class="o">|</span> <span class="s2">&quot;common.SubTensor&quot;</span> <span class="o">|</span> <span class="s2">&quot;common.SubWithTorchFunction&quot;</span> <span class="o">|</span>
            <span class="s2">&quot;torch.nn.parameter.Parameter&quot;</span> <span class="o">|</span> <span class="ow">and</span> <span class="n">subclasses</span> <span class="n">of</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
</pre></div>
</div>
<div class="section" id="special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">
<h4>Special note on torch.nn.ModuleList and torch.nn.ModuleDict<a class="headerlink" href="#special-note-on-torch-nn-modulelist-and-torch-nn-moduledict" title="Permalink to this headline">¶</a></h4>
<p>Although <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> are defined as a list and dictionary in Python,
they behave more like tuples in TorchScript.</p>
<ul class="simple">
<li><p>In TorchScript, instances of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code>  or <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> are immutable.</p></li>
<li><p>Code that iterates over <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> or <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> is completely unrolled so that elements of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleList</span></code> or keys of <code class="docutils literal notranslate"><span class="pre">torch.nn.ModuleDict</span></code> can be of different subclasses of <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code>.</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">))</span>

<span class="n">script_g</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">script_g</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-class">
<h3>Custom Class<a class="headerlink" href="#custom-class" title="Permalink to this headline">¶</a></h3>
<p>Unlike built-in classes, semantics of custom classes are user-defined and the entire class definition must be compilable to TorchScript IR and subject to TorchScript type-checking rules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSClassDef</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span> <span class="s2">&quot;@torch.jit.script&quot;</span> <span class="p">]</span>
            <span class="s2">&quot;class&quot;</span> <span class="n">ClassName</span> <span class="p">[</span> <span class="s2">&quot;(object)&quot;</span> <span class="p">]</span>  <span class="s2">&quot;:&quot;</span>
                    <span class="n">MethodDefinition</span> <span class="o">|</span>
                <span class="p">[</span> <span class="s2">&quot;@torch.jit.ignore&quot;</span> <span class="p">]</span> <span class="o">|</span> <span class="p">[</span> <span class="s2">&quot;@torch.jit.unused&quot;</span> <span class="p">]</span>
                    <span class="n">MethodDefinition</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p>Classes must be new-style classes (note that Python 3 supports only new-style classes, for Python 2.x new-style class is specified by subclassing from object)</p></li>
<li><p>Instance data attributes are statically typed, and instance attributes must be declared by assignments inside the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method</p></li>
<li><p>Method overloading is not supported (i.e., cannot have multiple methods with the same method name)</p></li>
<li><p>MethodDefinition must be compilable to TorchScript IR and adhere to TorchScript’s type-checking rules, (e.g., all methods must be valid TorchScript functions and class attribute definitions must be valid TorchScript statements)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch.jit.ignore</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.jit.unused</span></code> can be used to ignore the method or function that is not fully torchscriptable or should be ignored by the compiler</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<p>TorchScript custom classes are quite limited compared to their Python counterpart.</p>
<ul class="simple">
<li><p>do not support class attributes</p></li>
<li><p>do not support subclassing except for subclassing an interface type or object</p></li>
<li><p>do not support method overloading</p></li>
<li><p>must initialize all its instance attributes in  <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>; this is because TorchScript constructs a static schema of the class by inferring attribute types in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code></p></li>
<li><p>must contain only methods that satisfy TorchScript type-checking rules and are compilable to TorchScript IRs</p></li>
</ul>
<p><strong>Example</strong>:</p>
<p>Python classes can be used in TorchScript if they are annotated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.script</span></code>, similar to how a TorchScript function would be declared:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">val</span>
</pre></div>
</div>
<p><strong>Example</strong>:</p>
<p>A TorchScript custom class type must “declare” all its instance attributes by assignments in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>. If an instance attribute is not defined in <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> but accessed in other methods of the class, the class cannot be compiled as a TorchScript class, as shown in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># ERROR: self.x is not defined in __init__</span>
<span class="k">def</span> <span class="nf">assign_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The above class will fail to compile and issue the following error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError:
Tried to set nonexistent attribute: x. Did you forget to initialize it in __init__()?:
def assign_x(self):
    self.x = torch.rand(2, 3)
    ~~~~~~~~~~~~~~~~~~~~~~~~ &lt;--- HERE
</pre></div>
</div>
<p><strong>Example</strong>:</p>
<p>In this example, a TorchScript custom class defines a class variable name, which is not allowed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MyClass&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">fn</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">MyClass</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>It leads to the following compile-time error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RuntimeError:
Tried to access nonexistent attribute or method &#39;name&#39; of type &#39;__torch__.MyClass&#39;. Did you forget to initialize an attribute in __init__()?:
    File &quot;test-class2.py&quot;, line 10
def fn(a: MyClass):
    return a.name
        ~~~~~~ &lt;--- HERE
</pre></div>
</div>
</div>
<div class="section" id="enum-type">
<h3>Enum Type<a class="headerlink" href="#enum-type" title="Permalink to this headline">¶</a></h3>
<p>Like custom classes, semantics of enum type are user-defined and the entire class definition must be compilable to TorchScript IR and adhere to TorchScript type-checking rules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSEnumDef</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;class&quot;</span> <span class="n">Identifier</span> <span class="s2">&quot;(enum.Enum | TSEnumType)&quot;</span> <span class="s2">&quot;:&quot;</span>
            <span class="p">(</span> <span class="n">MemberIdentifier</span> <span class="s2">&quot;=&quot;</span> <span class="n">Value</span> <span class="p">)</span><span class="o">+</span>
            <span class="p">(</span> <span class="n">MethodDefinition</span> <span class="p">)</span><span class="o">*</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p>Value must be a TorchScript literal of type <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code>, and must be of the same TorchScript type</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TSEnumType</span></code> is the name of a TorchScript enumerated type. Similar to Python enum, TorchScript allows restricted <code class="docutils literal notranslate"><span class="pre">Enum</span></code> subclassing, that is, subclassing an enumerated is allowed only if it does not define any members.</p></li>
</ul>
<p><strong>Compared to Python</strong></p>
<ul class="simple">
<li><p>TorchScript supports only <code class="docutils literal notranslate"><span class="pre">enum.Enum</span></code>, but not other variations such as <code class="docutils literal notranslate"><span class="pre">enum.IntEnum</span></code>, <code class="docutils literal notranslate"><span class="pre">enum.Flag</span></code>, <code class="docutils literal notranslate"><span class="pre">enum.IntFlag</span></code>, or  <code class="docutils literal notranslate"><span class="pre">enum.auto</span></code></p></li>
<li><p>Values of TorchScript enum members must be of the same type and can only be of <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code> type, whereas Python enum members can be of any type</p></li>
<li><p>Enums containing methods are ignored in TorchScript.</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager: &quot;</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript: &quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Example</strong>:</p>
<p>The following example shows the case of restricted enum subclassing, where <code class="docutils literal notranslate"><span class="pre">BaseColor</span></code> does not define any member, thus can be subclassed by <code class="docutils literal notranslate"><span class="pre">Color</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">BaseColor</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">BaseColor</span><span class="p">):</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">enum_fn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Color</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">enum_fn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript: &quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager: &quot;</span><span class="p">,</span> <span class="n">enum_fn</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="torchscript-module-class">
<h3>TorchScript Module Class<a class="headerlink" href="#torchscript-module-class" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is a special class type that is inferred from object instances created outside TorchScript. <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is named by the Python class of the object instance. The <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of the Python class is not considered as a TorchScript method, so it does not have to comply with TorchScript’s type checking rules.</p>
<p>Since the type schema of module instance class is constructed directly from an instance object (created outside the scope of TorchScript), rather than inferred from <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> like custom classes. It is possible that two objects of the same instance class type follow two different type schemas.</p>
<p>In this sense, <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> is not really a static type. Therefore, for type safety considerations, <code class="docutils literal notranslate"><span class="pre">TSModuleType</span></code> cannot be used in a TorchScript type annotation or be composed with <code class="docutils literal notranslate"><span class="pre">TSType</span></code>.</p>
</div>
<div class="section" id="module-instance-class">
<h3>Module Instance Class<a class="headerlink" href="#module-instance-class" title="Permalink to this headline">¶</a></h3>
<p>TorchScript module type represents type schema of a user-defined PyTorch module instance.  When scripting a PyTorch module, the module object is always created outside TorchScript (i.e., passed in as parameter to <code class="docutils literal notranslate"><span class="pre">forward</span></code>), The Python module class is treated as a module instance class, so the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of the Python module class is not subject to the type checking rules of TorchScript.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TSModuleType</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;class&quot;</span> <span class="n">Identifier</span> <span class="s2">&quot;(torch.nn.Module)&quot;</span> <span class="s2">&quot;:&quot;</span>
                    <span class="n">ClassBodyDefinition</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forward()</span></code> and other methods decorated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code> must be compilable to TorchScript IR and subject to TorchScript’s type checking rules</p></li>
</ul>
<p>Unlike custom classes, only the forward method and other methods decorated with <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code>  of the module type need to be compilable. Most notably, <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is not considered a TorchScript method. Consequently, module type constructors cannot be invoked within the scope of TorchScript. Instead, TorchScript module objects are always constructed outside and passed into <code class="docutils literal notranslate"><span class="pre">torch.jit.script(ModuleObj)</span></code>.</p>
<p><strong>Example</strong>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">inc</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">5</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Second instance: </span><span class="si">{</span><span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>First instance: 4
Second instance: tensor([4., 4., 4., 4., 4.])
</pre></div>
</div>
<p>This example illustrates a few features of module types:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> instance is created outside the scope of TorchScript (i.e., before invoking <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__()</span></code> is not considered to be a TorchScript method, therefore it does not have to be annotated and can contain arbitrary Python code. In addition, the <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> method of an instance class cannot be invoked in TorchScript code.* Because <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> instances are instantiated in Python, in this example, <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code> and <code class="docutils literal notranslate"><span class="pre">TestModule(2)</span></code> create two instances with different types for its data attributes. <code class="docutils literal notranslate"><span class="pre">self.x</span> <span class="pre">is</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">``float</span></code> for <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">self.y</span></code> is of type <code class="docutils literal notranslate"><span class="pre">int</span></code> for <code class="docutils literal notranslate"><span class="pre">TestModule(2.0)</span></code>.</p></li>
<li><p>TorchScript automatically compiles other methods (e.g., <code class="docutils literal notranslate"><span class="pre">mul()</span></code>) invoked by methods annotated via <code class="docutils literal notranslate"><span class="pre">&#64;torch.jit.export</span></code> or <code class="docutils literal notranslate"><span class="pre">forward()</span></code> methods</p></li>
<li><p>Entry-points to a TorchScript program are either <code class="docutils literal notranslate"><span class="pre">forward()</span></code> of a module type or functions annotated as <code class="docutils literal notranslate"><span class="pre">torch.jit.script</span></code> or methods annotated as <code class="docutils literal notranslate"><span class="pre">torch.jit.export</span></code></p></li>
</ul>
<p><strong>Example</strong>:</p>
<p>The following shows an incorrect usage of module type. Specifically, this example invokes the constructor of <code class="docutils literal notranslate"><span class="pre">TestModule</span></code> inside the scope of TorchScript.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">TestModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">v</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">export</span>
    <span class="k">def</span> <span class="nf">doSomething</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># error: should not invoke the constructor of module type</span>
        <span class="n">myModel</span> <span class="o">=</span> <span class="n">TestModule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">myModel</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="c1"># m = torch.jit.script(MyModel(2)) # Results in below RuntimeError</span>
<span class="c1"># RuntimeError: Could not get name of python class object</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-annotation">
<span id="id2"></span><h2><a class="toc-backref" href="#id7">Type Annotation</a><a class="headerlink" href="#type-annotation" title="Permalink to this headline">¶</a></h2>
<p>Since TorchScript is statically typed, programmers need to annotate types at <em>strategic points</em> of TorchScript code so that every local variable or
instance data attribute has a static type, and every function and method has a statically typed signature.</p>
<div class="section" id="when-to-annotate-types">
<h3>When to annotate types<a class="headerlink" href="#when-to-annotate-types" title="Permalink to this headline">¶</a></h3>
<p>In general, type annotations are only needed in places where static types cannot be automatically inferred, such as parameters or sometimes return types to
methods or functions. Types of local variables and data attributes are often automatically inferred from their assignment statements. Sometimes, an inferred type
may be too restrictive, e.g., <code class="docutils literal notranslate"><span class="pre">x</span></code> being inferred as <code class="docutils literal notranslate"><span class="pre">NoneType</span></code> through assignment <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">None</span></code>, whereas <code class="docutils literal notranslate"><span class="pre">x</span></code> is actually used as an <code class="docutils literal notranslate"><span class="pre">Optional</span></code>. In such
cases, type annotations may be needed to overwrite auto inference, e.g., <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None</span></code>. Note that it is always safe to type annotate a local variable
or data attribute even if its type can be automatically inferred. But the annotated type must be congruent with TorchScript’s type checking.</p>
<p>When a parameter, local variable, or data attribute is not type annotated and its type cannot be automatically inferred, TorchScript assumes it to be a
default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>, <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code>, or <code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">TensorType]</span></code>.</p>
</div>
<div class="section" id="annotate-function-signature">
<h3>Annotate function signature<a class="headerlink" href="#annotate-function-signature" title="Permalink to this headline">¶</a></h3>
<p>Since parameter may not be automatically inferred from the body of the function (including both functions and methods), they need to be type annotated,
otherwise they assume the default type <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>.</p>
<p>TorchScript supports two styles for method and function signature type annotation:</p>
<ul class="simple">
<li><p><strong>Python3-style</strong> annotates types directly on the signature. As such, it allows individual parameters be left unannotated (whose type will be the default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>) , or the return type be left unannotated (whose type will be automatically inferred).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python3Annotation</span> <span class="o">:=</span> <span class="s2">&quot;def&quot;</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">&quot;(&quot;</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">&quot;)&quot;</span> <span class="p">]</span> <span class="p">[</span><span class="n">ReturnAnnot</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span>
                     <span class="n">FuncOrMethodBody</span>
<span class="n">ParamAnnot</span> <span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span> <span class="s2">&quot;:&quot;</span> <span class="n">TSType</span> <span class="p">]</span> <span class="s2">&quot;,&quot;</span>
<span class="n">ReturnAnnot</span> <span class="o">:=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">TSType</span>
</pre></div>
</div>
<p>Note that using Python3 style, the type of <code class="docutils literal notranslate"><span class="pre">self</span></code> is automatically inferred and should not be annotated.</p>
<ul class="simple">
<li><p><strong>Mypy style</strong> annotates types as a comment right below the function/method declaration. In the My-Py style, since parameter names do not appear in the annotation, all parameters have to be annotated.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyPyAnnotation</span> <span class="o">:=</span> <span class="s2">&quot;# type:&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="n">ParamAnnot</span><span class="o">*</span> <span class="s2">&quot;)&quot;</span> <span class="p">[</span> <span class="n">ReturnAnnot</span> <span class="p">]</span>
<span class="n">ParamAnnot</span> <span class="o">:=</span> <span class="n">TSType</span> <span class="s2">&quot;,&quot;</span>
<span class="n">ReturnAnnot</span> <span class="o">:=</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">TSType</span>
</pre></div>
</div>
<p><strong>Example 1</strong></p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">a</span></code> is not annotated and assumes the default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> is annotated as type <code class="docutils literal notranslate"><span class="pre">int</span></code>, and the return type is not
annotated and is automatically inferred as type <code class="docutils literal notranslate"><span class="pre">TensorType</span></code> (based on the type of the value being returned).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>Example 2</strong></p>
<p>The following code snippet gives an example of using mypy style annotation. Note that parameters or return values must be annotated even if some of
them assume the default type.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># type: (torch.Tensor, int) → torch.Tensor</span>
    <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="annotate-variables-and-data-attributes">
<h3>Annotate variables and data attributes<a class="headerlink" href="#annotate-variables-and-data-attributes" title="Permalink to this headline">¶</a></h3>
<p>In general, types of data attributes (including class and instance data attributes) and local variables can be automatically inferred from assignment statements.
Sometimes, however, if a variable or attribute is associated with values of different types (e.g., as <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>), then they may need to be explicitly
type annotated as a <em>wider</em> type such as <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> or <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<div class="section" id="local-variables">
<h4>Local variables<a class="headerlink" href="#local-variables" title="Permalink to this headline">¶</a></h4>
<p>Local variables can be annotated according to Python3 typing module annotation rule, i.e.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LocalVarAnnotation</span> <span class="o">:=</span> <span class="n">Identifier</span> <span class="p">[</span><span class="s2">&quot;:&quot;</span> <span class="n">TSType</span><span class="p">]</span> <span class="s2">&quot;=&quot;</span> <span class="n">Expr</span>
</pre></div>
</div>
<p>In general, types of local variables can be automatically inferred. In some cases, however, programmers may need to annotate a multi-type for local variables
that may be associated with different concrete types. Typical multi-types include <code class="docutils literal notranslate"><span class="pre">Optional[T]</span></code> and <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<p><strong>Example</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">setVal</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">setVal</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">6</span><span class="p">])</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="n">m</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="instance-data-attributes">
<h4>Instance data attributes<a class="headerlink" href="#instance-data-attributes" title="Permalink to this headline">¶</a></h4>
<p>For <code class="docutils literal notranslate"><span class="pre">ModuleType</span></code> classes, instance data attributes can be annotated according to Python3 typing module annotation rules. Instance data attributes can be annotated (optionally) as final
via <code class="docutils literal notranslate"><span class="pre">Final</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;class&quot;</span> <span class="n">ClassIdentifier</span> <span class="s2">&quot;(torch.nn.Module):&quot;</span>
<span class="n">InstanceAttrIdentifier</span> <span class="s2">&quot;:&quot;</span> <span class="p">[</span><span class="s2">&quot;Final(&quot;</span><span class="p">]</span> <span class="n">TSType</span> <span class="p">[</span><span class="s2">&quot;)&quot;</span><span class="p">]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">InstanceAttrIdentifier</span></code> is the name of an instance attribute and <code class="docutils literal notranslate"><span class="pre">Final</span></code> indicates that the attribute cannot be re-assigned outside
of <code class="docutils literal notranslate"><span class="pre">__init__</span></code> or overridden in subclasses.</p>
<p><strong>Example</strong></p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">a</span></code> is not annotated and assumes the default type of <code class="docutils literal notranslate"><span class="pre">TensorType</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code> is annotated as type <code class="docutils literal notranslate"><span class="pre">int</span></code>, and the return type is not
annotated and is automatically inferred as type <code class="docutils literal notranslate"><span class="pre">TensorType</span></code> (based on the type of the value being returned).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>

<span class="k">class</span> <span class="nc">MyModule</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">offset_</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">offset_</span> <span class="o">=</span> <span class="n">offset</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-annotation-apis">
<h3>Type Annotation APIs<a class="headerlink" href="#type-annotation-apis" title="Permalink to this headline">¶</a></h3>
<div class="section" id="torch-jit-annotate-t-expr">
<h4><code class="docutils literal notranslate"><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code><a class="headerlink" href="#torch-jit-annotate-t-expr" title="Permalink to this headline">¶</a></h4>
<p>This API annotates type <code class="docutils literal notranslate"><span class="pre">T</span></code> to an expression <code class="docutils literal notranslate"><span class="pre">expr</span></code>. This is often used when the default type of an expression is not the type intended by the programmer.
For instance, an empty list (dictionary) has the default type of <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code> (<code class="docutils literal notranslate"><span class="pre">Dict[TensorType,</span> <span class="pre">TensorType]</span></code>) but sometimes it may be used to initialize
a list of some other types. Another common use case is for annotating the return type of <code class="docutils literal notranslate"><span class="pre">tensor.tolist()</span></code>. Note, however that it cannot be used to annotate
the type of a module attribute in <cite>__init__</cite>; <code class="docutils literal notranslate"><span class="pre">torch.jit.Attribute</span></code> should be used for this instead.</p>
<p><strong>Example</strong></p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">[]</span></code> is declared as a list of integers via <code class="docutils literal notranslate"><span class="pre">torch.jit.annotate</span></code> (instead of assuming <code class="docutils literal notranslate"><span class="pre">[]</span></code> to be the default type of <code class="docutils literal notranslate"><span class="pre">List[TensorType]</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">[]),</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">jit</span><span class="o">.</span><span class="n">script</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Eager:&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TorchScript:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="generated/torch.jit.annotate.html#torch.jit.annotate" title="torch.jit.annotate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">torch.jit.annotate()</span></code></a> for more information.</p>
</div>
</div>
<div class="section" id="appendix">
<h3>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h3>
<div class="section" id="unsupported-typing-constructs">
<h4>Unsupported Typing Constructs<a class="headerlink" href="#unsupported-typing-constructs" title="Permalink to this headline">¶</a></h4>
<p>TorchScript does not support all features and types of the Python3 <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing">typing</a> module.
Any functionality from the typing <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing">typing</a> module not explicitly specified in this
documentation is unsupported. The following table summarizes <code class="docutils literal notranslate"><span class="pre">typing</span></code> constructs that are either unsupported or supported with restrictions in TorchScript.</p>
<table class="docutils colwidths-auto align-default">
<tbody>
<tr class="row-odd"><td><p>Item</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Any</span></code></p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.NoReturn</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Union</span></code></p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Callable</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Literal</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.ClassVar</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.Final</span></code></p></td>
<td><p>Supported for module attributes, class attribute, and annotations but not for functions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">typing.AnyStr</span></code></p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">typing.overload</span></code></p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-odd"><td><p>Type aliases</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p>Nominal typing</p></td>
<td><p>In development</p></td>
</tr>
<tr class="row-odd"><td><p>Structural typing</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-even"><td><p>NewType</p></td>
<td><p>Not supported</p></td>
</tr>
<tr class="row-odd"><td><p>Generics</p></td>
<td><p>Not supported</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="expressions">
<span id="id4"></span><h2><a class="toc-backref" href="#id8">Expressions</a><a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<p>The following section describes the grammar of expressions that are supported in TorchScript.
It is modeled after <a class="reference external" href="https://docs.python.org/3/reference/expressions.html">the expressions chapter of the Python language reference</a>.</p>
<div class="section" id="arithmetic-conversions">
<h3>Arithmetic Conversions<a class="headerlink" href="#arithmetic-conversions" title="Permalink to this headline">¶</a></h3>
<p>There are a number of implicit type conversions that are performed in TorchScript:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> with a <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code> datatype can be implicitly converted to an instance of <code class="docutils literal notranslate"><span class="pre">FloatType</span></code> or <code class="docutils literal notranslate"><span class="pre">IntType</span></code> provided that it has a size of 0, and does not have <code class="docutils literal notranslate"><span class="pre">require_grad</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code> and will not require narrowing.</p></li>
<li><p>instances of <code class="docutils literal notranslate"><span class="pre">StringType</span></code> can be implicitly converted to <code class="docutils literal notranslate"><span class="pre">DeviceType</span></code></p></li>
<li><p>the above implicit conversion rules can be applied to instances of <code class="docutils literal notranslate"><span class="pre">TupleType</span></code> to produce instances of <code class="docutils literal notranslate"><span class="pre">ListType</span></code> with the appropriate contained type</p></li>
</ul>
<p>Explicit conversions can be invoked using the <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code> built-in functions
that accept primitive data types as arguments and can accept user-defined types if they implement
<code class="docutils literal notranslate"><span class="pre">__bool__</span></code>, <code class="docutils literal notranslate"><span class="pre">__str__</span></code>, etc.</p>
</div>
<div class="section" id="atoms">
<h3>Atoms<a class="headerlink" href="#atoms" title="Permalink to this headline">¶</a></h3>
<p>Atoms are the most basic elements of expressions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span> <span class="o">|</span> <span class="n">literal</span> <span class="o">|</span> <span class="n">enclosure</span>
<span class="n">enclosure</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">parenth_form</span> <span class="o">|</span> <span class="n">list_display</span> <span class="o">|</span> <span class="n">dict_display</span>
</pre></div>
</div>
<div class="section" id="identifiers">
<h4>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h4>
<p>The rules that dictate what is a legal identifer in TorchScript are the same as
their <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">Python counterparts</a>.</p>
</div>
<div class="section" id="literals">
<h4>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">literal</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">stringliteral</span> <span class="o">|</span> <span class="n">integer</span> <span class="o">|</span> <span class="n">floatnumber</span>
</pre></div>
</div>
<p>Evaluation of a literal yields an object of the appropriate type with the specific value
(with approximations applied as necessary for floats). Literals are immutable, and multiple evaluations
of identical literals may obtain the same object or distinct objects with the same value.
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#string-and-bytes-literals">stringliteral</a>,
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#integer-literals">integer</a>, and
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#floating-point-literals">floatnumber</a>
are defined in the same way as their Python counterparts.</p>
</div>
<div class="section" id="parenthesized-forms">
<h4>Parenthesized Forms<a class="headerlink" href="#parenthesized-forms" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parenth_form</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;(&#39;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s1">&#39;)&#39;</span>
</pre></div>
</div>
<p>A parenthesized expression list yields whatever the expression list yields. If the list contains at least one
comma, it yields a <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>; otherwise, it yields the single expression inside the expression list. An empty
pair of parentheses yields an empty <code class="docutils literal notranslate"><span class="pre">Tuple</span></code> object (<code class="docutils literal notranslate"><span class="pre">Tuple[]</span></code>).</p>
</div>
<div class="section" id="list-and-dictionary-displays">
<h4>List and Dictionary Displays<a class="headerlink" href="#list-and-dictionary-displays" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="n">comp_for</span>
<span class="n">comp_for</span>           <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;for&#39;</span> <span class="n">target_list</span> <span class="s1">&#39;in&#39;</span> <span class="n">or_expr</span>
<span class="n">list_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;[&#39;</span> <span class="p">[</span><span class="n">expression_list</span> <span class="o">|</span> <span class="n">list_comprehension</span><span class="p">]</span> <span class="s1">&#39;]&#39;</span>
<span class="n">dict_display</span>       <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;{&#39;</span> <span class="p">[</span><span class="n">key_datum_list</span> <span class="o">|</span> <span class="n">dict_comprehension</span><span class="p">]</span> <span class="s1">&#39;}&#39;</span>
<span class="n">key_datum_list</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">key_datum</span><span class="p">)</span><span class="o">*</span>
<span class="n">key_datum</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="s1">&#39;:&#39;</span> <span class="n">expression</span>
<span class="n">dict_comprehension</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">key_datum</span> <span class="n">comp_for</span>
</pre></div>
</div>
<p>Lists and dicts can be constructed by either listing the container contents explicitly or providing
instructions on how to compute them via a set of looping instructions (i.e. a <em>comprehension</em>). A comprehension
is semantically equivalent to using a for loop and appending to an ongoing list the expression of the comprehension.
Comprehensions implicitly create their own scope to make sure the items of the target list do not leak into the
enclosing scope. In the case that container items are explicitly listed, the expressions in the expression list
are evaluated left-to-right. If a key is repeated in a <code class="docutils literal notranslate"><span class="pre">dict_display</span></code> that has a <code class="docutils literal notranslate"><span class="pre">key_datum_list</span></code>, then, the
resultant dictionary uses the value from the rightmost datum in the list that uses the repeated key.</p>
</div>
</div>
<div class="section" id="primaries">
<h3>Primaries<a class="headerlink" href="#primaries" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primary</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">atom</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span> <span class="o">|</span> <span class="n">slicing</span> <span class="o">|</span> <span class="n">call</span>
</pre></div>
</div>
<div class="section" id="attribute-references">
<h4>Attribute References<a class="headerlink" href="#attribute-references" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeref</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;.&#39;</span> <span class="n">identifier</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">primary</span></code> must evaluate to an object of a type that supports attribute references that has an attribute named
<code class="docutils literal notranslate"><span class="pre">identifier</span></code>.</p>
</div>
<div class="section" id="subscriptions">
<h4>Subscriptions<a class="headerlink" href="#subscriptions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subscription</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;[&#39;</span> <span class="n">expression_list</span> <span class="s1">&#39;]&#39;</span>
</pre></div>
</div>
<p>The primary must evaluate to an object that supports subscription. If it is a <code class="docutils literal notranslate"><span class="pre">List</span></code> , <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, or <code class="docutils literal notranslate"><span class="pre">str</span></code>,
the expression list must evaluate to an integer or slice. If it is a <code class="docutils literal notranslate"><span class="pre">Dict</span></code>, the expression list must evaluate
to an object of the same type as the key type of the <code class="docutils literal notranslate"><span class="pre">Dict</span></code>. If the primary is a <code class="docutils literal notranslate"><span class="pre">ModuleList</span></code>, the expression
list must be an <code class="docutils literal notranslate"><span class="pre">integer</span></code> literal. If the primary is a <code class="docutils literal notranslate"><span class="pre">ModuleDict</span></code>, the expression must be a <code class="docutils literal notranslate"><span class="pre">stringliteral</span></code>.</p>
</div>
<div class="section" id="slicings">
<h4>Slicings<a class="headerlink" href="#slicings" title="Permalink to this headline">¶</a></h4>
<p>A slicing selects a range of items in a <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">Tuple</span></code>, <code class="docutils literal notranslate"><span class="pre">List</span></code> or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Slicings may be used as
expressions or targets in assignment or <code class="docutils literal notranslate"><span class="pre">del</span></code> statements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slicing</span>      <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;[&#39;</span> <span class="n">slice_list</span> <span class="s1">&#39;]&#39;</span>
<span class="n">slice_list</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">slice_item</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">slice_item</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="p">]</span>
<span class="n">slice_item</span>   <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="o">|</span> <span class="n">proper_slice</span>
<span class="n">proper_slice</span> <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="s1">&#39;:&#39;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">[</span><span class="s1">&#39;:&#39;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>Slicings with more than one slice item in their slice lists can only be used with primaries that evaluate to an
object of type <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="s1">&#39;(&#39;</span> <span class="n">argument_list</span> <span class="s1">&#39;)&#39;</span>
<span class="n">argument_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">args</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span> <span class="n">kwargs</span><span class="p">]</span> <span class="o">|</span> <span class="n">kwargs</span>
<span class="n">args</span>          <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">arg</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwargs</span>        <span class="p">:</span><span class="o">:=</span>  <span class="p">[</span><span class="n">kwarg</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">kwarg</span><span class="p">)</span><span class="o">*</span><span class="p">]</span>
<span class="n">kwarg</span>         <span class="p">:</span><span class="o">:=</span>  <span class="n">arg</span> <span class="s1">&#39;=&#39;</span> <span class="n">expression</span>
<span class="n">arg</span>           <span class="p">:</span><span class="o">:=</span>  <span class="n">identifier</span>
</pre></div>
</div>
<p><cite>primary</cite> must desugar or evaluate to a callable object. All argument expressions are evaluated
before the call is attempted.</p>
</div>
</div>
<div class="section" id="power-operator">
<h3>Power Operator<a class="headerlink" href="#power-operator" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">power</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">primary</span> <span class="p">[</span><span class="s1">&#39;**&#39;</span> <span class="n">u_expr</span><span class="p">]</span>
</pre></div>
</div>
<p>The power operator has the same semantics as the built-in pow function (not supported); it computes its
left argument raised to the power of its right argument. It binds more tightly than unary operators on the
left, but less tightly than unary operators on the right; i.e. <code class="docutils literal notranslate"><span class="pre">-2</span> <span class="pre">**</span> <span class="pre">-3</span> <span class="pre">==</span> <span class="pre">-(2</span> <span class="pre">**</span> <span class="pre">(-3))</span></code>.  The left and right
operands can be <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Scalars are broadcast in the case of scalar-tensor/tensor-scalar
exponentiation operations, and tensor-tensor exponentiation is done elementwise without any broadcasting.</p>
</div>
<div class="section" id="unary-and-arithmetic-bitwise-operations">
<h3>Unary and Arithmetic Bitwise Operations<a class="headerlink" href="#unary-and-arithmetic-bitwise-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">power</span> <span class="o">|</span> <span class="s1">&#39;-&#39;</span> <span class="n">power</span> <span class="o">|</span> <span class="s1">&#39;~&#39;</span> <span class="n">power</span>
</pre></div>
</div>
<p>The unary <code class="docutils literal notranslate"><span class="pre">-</span></code> operator yields the negation of its argument. The unary <code class="docutils literal notranslate"><span class="pre">~</span></code> operator yields the bitwise inversion
of its argument. <code class="docutils literal notranslate"><span class="pre">-</span></code> can be used with <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, and <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code>.
<code class="docutils literal notranslate"><span class="pre">~</span></code> can only be used with <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> of <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
</div>
<div class="section" id="binary-arithmetic-operations">
<h3>Binary Arithmetic Operations<a class="headerlink" href="#binary-arithmetic-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;*&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;@&#39;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;//&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;/&#39;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s1">&#39;%&#39;</span> <span class="n">u_expr</span>
<span class="n">a_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">&#39;+&#39;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s1">&#39;-&#39;</span> <span class="n">m_expr</span>
</pre></div>
</div>
<p>The binary arithmetic operators can operate on <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">float</span></code>. For tensor-tensor ops, both arguments must
have the same shape. For scalar-tensor or tensor-scalar ops, the scalar is usually broadcast to the size of the
tensor. Division ops can only accept scalars as their right-hand side argument, and do not support broadcasting.
The <code class="docutils literal notranslate"><span class="pre">&#64;</span> <span class="pre">``operator</span> <span class="pre">is</span> <span class="pre">for</span> <span class="pre">matrix</span> <span class="pre">multiplication</span> <span class="pre">and</span> <span class="pre">only</span> <span class="pre">operates</span> <span class="pre">on</span> <span class="pre">``Tensor</span></code> arguments. The multiplication operator
(<code class="docutils literal notranslate"><span class="pre">*</span></code>) can be used with a list and integer in order to get a result that is the original list repeated a certain
number of times.</p>
</div>
<div class="section" id="shifting-operations">
<h3>Shifting Operations<a class="headerlink" href="#shifting-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shift_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">a_expr</span> <span class="o">|</span> <span class="n">shift_expr</span> <span class="p">(</span> <span class="s1">&#39;&lt;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&gt;&#39;</span> <span class="p">)</span> <span class="n">a_expr</span>
</pre></div>
</div>
<p>These operators accept two <code class="docutils literal notranslate"><span class="pre">int</span></code> arguments, two <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> arguments, or a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> argument and an <code class="docutils literal notranslate"><span class="pre">int</span></code> or
<code class="docutils literal notranslate"><span class="pre">float</span></code> argument. In all cases, a right shift by <code class="docutils literal notranslate"><span class="pre">n</span></code> is defined as floor division by <code class="docutils literal notranslate"><span class="pre">pow(2,</span> <span class="pre">n)</span></code> and a left shift
by <code class="docutils literal notranslate"><span class="pre">n</span></code> is defined as multiplication by <code class="docutils literal notranslate"><span class="pre">pow(2,</span> <span class="pre">n)</span></code>. When both arguments are <code class="docutils literal notranslate"><span class="pre">Tensors</span></code>, they must have the same
shape. When one is a scalar and the other is a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, the scalar is logically broadcast to match the size of
the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="binary-bitwise-operations">
<h3>Binary Bitwise Operations<a class="headerlink" href="#binary-bitwise-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">and_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">shift_expr</span> <span class="o">|</span> <span class="n">and_expr</span> <span class="s1">&#39;&amp;&#39;</span> <span class="n">shift_expr</span>
<span class="n">xor_expr</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">and_expr</span> <span class="o">|</span> <span class="n">xor_expr</span> <span class="s1">&#39;^&#39;</span> <span class="n">and_expr</span>
<span class="n">or_expr</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">xor_expr</span> <span class="o">|</span> <span class="n">or_expr</span> <span class="s1">&#39;|&#39;</span> <span class="n">xor_expr</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator computes the bitwise AND of its arguments, the <code class="docutils literal notranslate"><span class="pre">^</span></code> the bitwise XOR and <code class="docutils literal notranslate"><span class="pre">|</span></code> the bitwise OR.
Both operands must be <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, or the left operand must be <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> and the right operand must be
<code class="docutils literal notranslate"><span class="pre">int</span></code>. When both operands are <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, they must have the same shape. When the right operand is <code class="docutils literal notranslate"><span class="pre">int</span></code>, and
the left operand is <code class="docutils literal notranslate"><span class="pre">Tensor</span></code> , the right operand is logically broadcast to match the shape of the <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>.</p>
</div>
<div class="section" id="comparisons">
<h3>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">comparison</span>    <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">(</span><span class="n">comp_operator</span> <span class="n">or_expr</span><span class="p">)</span><span class="o">*</span>
<span class="n">comp_operator</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;==&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;!=&#39;</span> <span class="o">|</span> <span class="s1">&#39;is&#39;</span> <span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="s1">&#39;not&#39;</span><span class="p">]</span> <span class="s1">&#39;in&#39;</span>
</pre></div>
</div>
<p>A comparison yields a boolean values (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>) or, if one of the operands is a <code class="docutils literal notranslate"><span class="pre">Tensor</span></code>, a boolean
<code class="docutils literal notranslate"><span class="pre">Tensor</span></code>. Comparisons can be chained arbitrarily as long as they do not yield boolean <code class="docutils literal notranslate"><span class="pre">Tensors</span></code> that have more
than one element. <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">...</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">op1</span> <span class="pre">b</span> <span class="pre">and</span> <span class="pre">b</span> <span class="pre">op2</span> <span class="pre">c</span> <span class="pre">and</span> <span class="pre">...</span></code>.</p>
<div class="section" id="value-comparisons">
<h4>Value Comparisons<a class="headerlink" href="#value-comparisons" title="Permalink to this headline">¶</a></h4>
<p>The operators <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, and <code class="docutils literal notranslate"><span class="pre">!=</span></code> compare the values of two objects. The two objects generally need to be of
the same type, unless there is an implicit type conversion available between the objects. User-defined types can
be compared if rich comparison methods ( <code class="docutils literal notranslate"><span class="pre">__lt__</span></code> etc.) are defined on them. Built-in type comparison works like
Python:</p>
<ul class="simple">
<li><p>numbers are compared mathematically</p></li>
<li><p>strings are compared lexicographically</p></li>
<li><p>lists, tuples, and dicts can be compared only to other lists, tuples, and dicts of the same type and are compared using the comparison operator of corresponding elements</p></li>
</ul>
</div>
<div class="section" id="membership-test-operations">
<h4>Membership Test Operations<a class="headerlink" href="#membership-test-operations" title="Permalink to this headline">¶</a></h4>
<p>The operators <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> test for membership. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">x</span></code> is a member of <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">False``</span></code> otherwise.
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">s</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">s</span></code>. This operator is supported for lists, dicts, and tuples, and can be used with
user-defined types if they implement the <code class="docutils literal notranslate"><span class="pre">__contains__</span></code> method.</p>
</div>
<div class="section" id="identity-comparisons">
<h4>Identity Comparisons<a class="headerlink" href="#identity-comparisons" title="Permalink to this headline">¶</a></h4>
<p>For all types except <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">double</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code>, and <code class="docutils literal notranslate"><span class="pre">torch.device</span></code>, operators <code class="docutils literal notranslate"><span class="pre">is</span></code> and <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code> test for the object’s identity;
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> if and and only if <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the same object. For all other types, <code class="docutils literal notranslate"><span class="pre">is</span></code> is equivalent to
comparing them using <code class="docutils literal notranslate"><span class="pre">==</span></code>. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">y</span></code> yields the inverse of <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">is</span> <span class="pre">y</span></code>.</p>
</div>
</div>
<div class="section" id="boolean-operations">
<h3>Boolean Operations<a class="headerlink" href="#boolean-operations" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">or_test</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">and_test</span> <span class="o">|</span> <span class="n">or_test</span> <span class="s1">&#39;or&#39;</span> <span class="n">and_test</span>
<span class="n">and_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">not_test</span> <span class="o">|</span> <span class="n">and_test</span> <span class="s1">&#39;and&#39;</span> <span class="n">not_test</span>
<span class="n">not_test</span> <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;bool&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="n">or_expr</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span> <span class="n">comparison</span> <span class="o">|</span> <span class="s1">&#39;not&#39;</span> <span class="n">not_test</span>
</pre></div>
</div>
<p>User-defined objects can customize their conversion to <code class="docutils literal notranslate"><span class="pre">bool</span></code> by implementing a <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> method. The operator <code class="docutils literal notranslate"><span class="pre">not</span></code>
yields <code class="docutils literal notranslate"><span class="pre">True</span></code> if its operand is false, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise. The expression <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> first evaluates <code class="docutils literal notranslate"><span class="pre">x</span></code>; if it is <code class="docutils literal notranslate"><span class="pre">False</span></code>, its
value (<code class="docutils literal notranslate"><span class="pre">False</span></code>) is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned (<code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">True</span></code>). The expression <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code>
first evaluates <code class="docutils literal notranslate"><span class="pre">x</span></code>; if it is <code class="docutils literal notranslate"><span class="pre">True</span></code>, its value (<code class="docutils literal notranslate"><span class="pre">True</span></code>) is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned
(<code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
</div>
<div class="section" id="conditional-expressions">
<h3>Conditional Expressions<a class="headerlink" href="#conditional-expressions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditional_expression</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">or_expr</span> <span class="p">[</span><span class="s1">&#39;if&#39;</span> <span class="n">or_test</span> <span class="s1">&#39;else&#39;</span> <span class="n">conditional_expression</span><span class="p">]</span>
 <span class="n">expression</span>            <span class="p">:</span><span class="o">:=</span>  <span class="n">conditional_expression</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">c</span> <span class="pre">else</span> <span class="pre">y</span></code> first evaluates the condition <code class="docutils literal notranslate"><span class="pre">c</span></code> rather than x. If <code class="docutils literal notranslate"><span class="pre">c</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> is
evaluated and its value is returned; otherwise, <code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned. As with if-statements,
<code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> must evaluate to a value of the same type.</p>
</div>
<div class="section" id="expression-lists">
<h3>Expression Lists<a class="headerlink" href="#expression-lists" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression_list</span> <span class="p">:</span><span class="o">:=</span>  <span class="n">expression</span> <span class="p">(</span><span class="s1">&#39;,&#39;</span> <span class="n">expression</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="p">]</span>
<span class="n">starred_item</span>    <span class="p">:</span><span class="o">:=</span>  <span class="s1">&#39;*&#39;</span> <span class="n">primary</span>
</pre></div>
</div>
<p>A starred item can only appear on the left-hand side of an assignment statement, e.g. <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">*b,</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">...</span></code>.</p>
</div>
</div>
</div>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generated/torch.jit.script.html" class="btn btn-neutral float-right" title="torch.jit.script" accesskey="n" rel="next">Next <img src="_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="jit_language_reference.html" class="btn btn-neutral" title="TorchScript Language Reference" accesskey="p" rel="prev"><img src="_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Torch Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">TorchScript Language Reference</a><ul>
<li><a class="reference internal" href="#type-system">Type System</a><ul>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#torchscript-type-system-definition">TorchScript Type System Definition</a></li>
<li><a class="reference internal" href="#torchscript-types">TorchScript Types</a></li>
<li><a class="reference internal" href="#meta-types">Meta Types</a><ul>
<li><a class="reference internal" href="#any-type"><code class="docutils literal notranslate"><span class="pre">Any</span></code> Type</a></li>
<li><a class="reference internal" href="#operators-supported-for-any-type">Operators supported for <code class="docutils literal notranslate"><span class="pre">Any</span></code> type</a></li>
<li><a class="reference internal" href="#design-notes">Design notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primitive-types">Primitive Types</a></li>
<li><a class="reference internal" href="#structural-types">Structural Types</a></li>
<li><a class="reference internal" href="#nominal-types">Nominal Types</a></li>
<li><a class="reference internal" href="#builtin-class">Builtin Class</a><ul>
<li><a class="reference internal" href="#special-note-on-torch-nn-modulelist-and-torch-nn-moduledict">Special note on torch.nn.ModuleList and torch.nn.ModuleDict</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-class">Custom Class</a></li>
<li><a class="reference internal" href="#enum-type">Enum Type</a></li>
<li><a class="reference internal" href="#torchscript-module-class">TorchScript Module Class</a></li>
<li><a class="reference internal" href="#module-instance-class">Module Instance Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation">Type Annotation</a><ul>
<li><a class="reference internal" href="#when-to-annotate-types">When to annotate types</a></li>
<li><a class="reference internal" href="#annotate-function-signature">Annotate function signature</a></li>
<li><a class="reference internal" href="#annotate-variables-and-data-attributes">Annotate variables and data attributes</a><ul>
<li><a class="reference internal" href="#local-variables">Local variables</a></li>
<li><a class="reference internal" href="#instance-data-attributes">Instance data attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#type-annotation-apis">Type Annotation APIs</a><ul>
<li><a class="reference internal" href="#torch-jit-annotate-t-expr"><code class="docutils literal notranslate"><span class="pre">torch.jit.annotate(T,</span> <span class="pre">expr)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendix">Appendix</a><ul>
<li><a class="reference internal" href="#unsupported-typing-constructs">Unsupported Typing Constructs</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#expressions">Expressions</a><ul>
<li><a class="reference internal" href="#arithmetic-conversions">Arithmetic Conversions</a></li>
<li><a class="reference internal" href="#atoms">Atoms</a><ul>
<li><a class="reference internal" href="#identifiers">Identifiers</a></li>
<li><a class="reference internal" href="#literals">Literals</a></li>
<li><a class="reference internal" href="#parenthesized-forms">Parenthesized Forms</a></li>
<li><a class="reference internal" href="#list-and-dictionary-displays">List and Dictionary Displays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#primaries">Primaries</a><ul>
<li><a class="reference internal" href="#attribute-references">Attribute References</a></li>
<li><a class="reference internal" href="#subscriptions">Subscriptions</a></li>
<li><a class="reference internal" href="#slicings">Slicings</a></li>
<li><a class="reference internal" href="#calls">Calls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#power-operator">Power Operator</a></li>
<li><a class="reference internal" href="#unary-and-arithmetic-bitwise-operations">Unary and Arithmetic Bitwise Operations</a></li>
<li><a class="reference internal" href="#binary-arithmetic-operations">Binary Arithmetic Operations</a></li>
<li><a class="reference internal" href="#shifting-operations">Shifting Operations</a></li>
<li><a class="reference internal" href="#binary-bitwise-operations">Binary Bitwise Operations</a></li>
<li><a class="reference internal" href="#comparisons">Comparisons</a><ul>
<li><a class="reference internal" href="#value-comparisons">Value Comparisons</a></li>
<li><a class="reference internal" href="#membership-test-operations">Membership Test Operations</a></li>
<li><a class="reference internal" href="#identity-comparisons">Identity Comparisons</a></li>
</ul>
</li>
<li><a class="reference internal" href="#boolean-operations">Boolean Operations</a></li>
<li><a class="reference internal" href="#conditional-expressions">Conditional Expressions</a></li>
<li><a class="reference internal" href="#expression-lists">Expression Lists</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
         <script src="_static/jquery.js"></script>
         <script src="_static/underscore.js"></script>
         <script src="_static/doctools.js"></script>
         <script src="_static/language_data.js"></script>
     

  

  <script type="text/javascript" src="_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90545585-1', 'auto');
  ga('send', 'pageview');

</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117752657-2"></script>

<script>
  window.dataLayer = window.dataLayer || [];

  function gtag(){dataLayer.push(arguments);}

  gtag('js', new Date());
  gtag('config', 'UA-117752657-2');
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <ul>
            <li class="list-title">Stay Connected</li>
            <li>
              <div id="mc_embed_signup">
                <form
                  action="https://twitter.us14.list-manage.com/subscribe/post?u=75419c71fe0a935e53dfa4a3f&id=91d0dccd39"
                  method="post"
                  id="mc-embedded-subscribe-form"
                  name="mc-embedded-subscribe-form"
                  class="email-subscribe-form validate"
                  target="_blank"
                  novalidate>
                  <div id="mc_embed_signup_scroll" class="email-subscribe-form-fields-wrapper">
                    <div class="mc-field-group">
                      <label for="mce-EMAIL" style="display:none;">Email Address</label>
                      <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
                    </div>

                    <div id="mce-responses" class="clear">
                      <div class="response" id="mce-error-response" style="display:none"></div>
                      <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->

                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_75419c71fe0a935e53dfa4a3f_91d0dccd39" tabindex="-1" value=""></div>

                    <div class="clear">
                      <input type="submit" value="" name="subscribe" id="mc-embedded-subscribe" class="button email-subscribe-button">
                    </div>
                  </div>
                </form>
              </div>

            </li>
          </ul>

          <div class="footer-social-icons">
            <a href="https://www.facebook.com/pytorch" target="_blank" class="facebook"></a>
            <a href="https://twitter.com/pytorch" target="_blank" class="twitter"></a>
            <a href="https://www.youtube.com/pytorch" target="_blank" class="youtube"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pytorch.org/get-started">Get Started</a>
          </li>

          <li>
            <a href="https://pytorch.org/ecosystem">Ecosystem</a>
          </li>

          <li>
            <a href="https://pytorch.org/mobile">Mobile</a>
          </li>

          <li>
            <a href="https://pytorch.org/hub">PyTorch Hub</a>
          </li>

          <li>
            <a href="https://pytorch.org/blog/">Blog</a>
          </li>

          <li>
            <a href="https://pytorch.org/tutorials">Tutorials</a>
          </li>

          <li class="resources-mobile-menu-title" class="active">
            Docs
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/audio/stable/index.html">torchaudio</a>
            </li>

            <li>
              <a href="https://pytorch.org/text/stable/index.html">torchtext</a>
            </li>

            <li>
              <a href="https://pytorch.org/vision/stable/index.html">torchvision</a>
            </li>

            <li>
              <a href="https://pytorch.org/elastic/">TorchElastic</a>
            </li>

            <li>
              <a href="https://pytorch.org/serve/">TorchServe</a>
            </li>

            <li>
              <a href="https://pytorch.org/xla">PyTorch on XLA Devices</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            Resources
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/resources">Developer Resources</a>
            </li>

            <li>
              <a href="https://pytorch.org/features">About</a>
            </li>

            <li>
              <a href="https://pytorch.org/hub">Models (Beta)</a>
            </li>

            <li>
              <a href="https://pytorch.org/#community-module">Community</a>
            </li>

            <li>
              <a href="https://discuss.pytorch.org/">Forums</a>
            </li>
          </ul>

          <li>
            <a href="https://github.com/pytorch/pytorch">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>